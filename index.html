<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TU DUBLIN 0.3</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        .triangle {
            stroke: #000;
            stroke-width: 1;
            fill: none;
        }

        .user-point {
            fill: #f00;
            stroke: #000;
            stroke-width: 1;
        }
    </style>
</head>
<body>

<div>
    <label for="walkingSlider">Walking (%): </label>
    <input type="range" id="walkingSlider" name="walking" class="slider" min="0" max="100" value="33">
    <span id="walkingValue">33</span>%
</div>
<div>
    <label for="publicTransportSlider">Public Transport (%): </label>
    <input type="range" id="publicTransportSlider" name="publicTransport" class="slider" min="0" max="100" value="33">
    <span id="publicTransportValue">33</span>%
</div>
<div>
    <label for="privateCarsSlider">Private Cars (%): </label>
    <input type="range" id="privateCarsSlider" name="privateCars" class="slider" min="0" max="100" value="34">
    <span id="privateCarsValue">34</span>%
</div>

<div id="trianglePlot"></div>

<script>
    const width = 600, height = 600;
    const margin = { top: 30, right: 30, bottom: 30, left: 30 };

    const svg = d3.select('#trianglePlot').append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

    // Define the points of the triangle
    const scale = 0.6;
    const points = [
        [(1 - scale) * width / 2, scale * height], // bottom-left
        [width / 2, (1 - scale) * height / 2], // top-center
        [scale * width + (1 - scale) * width / 2, scale * height] // bottom-right
    ];
    
    // Draw the triangle
    svg.append('path')
        .attr('class', 'triangle')
        .attr('d', `M ${points.join('L ')} Z`);

    // Initial position of the user point
    const initialPoint = calculatePointPosition({ walking: 33, publicTransport: 33, privateCars: 34 });

    // User point element
    const userPoint = svg.append('circle')
        .attr('class', 'user-point')
        .attr('r', 5)
        .attr('cx', initialPoint.x)
        .attr('cy', initialPoint.y);

    // Function to calculate point position based on slider values
    function calculatePointPosition(data) {
        // This function should map the percentages to a point in the triangle
        const total = data.walking + data.publicTransport + data.privateCars;
        if (total !== 100) {
            // Prevent the calculation if the sum is not 100
            return;
        }
    
        // Calculate the barycentric coordinates
        const walkingFactor = data.walking / 100;
        const publicTransportFactor = data.publicTransport / 100;
        const privateCarsFactor = data.privateCars / 100;
    
        // Calculate the position of the point within the scaled triangle
        const x = (points[1][0] - points[0][0]) * publicTransportFactor + 
                  (points[2][0] - points[0][0]) * privateCarsFactor + points[0][0];
        const y = (points[1][1] - points[0][1]) * publicTransportFactor + 
                  (points[2][1] - points[0][1]) * privateCarsFactor + points[0][1];

    
        return { x: x, y: height - y }; // The y-coordinate is flipped because SVG coordinates start from the top-left corner
    }

    // Update function for sliders
    function updatePosition() {
        // Adjust the other two sliders to make sure the total is 100
        const walking = parseFloat(d3.select('#walkingSlider').property('value'));
        const publicTransport = parseFloat(d3.select('#publicTransportSlider').property('value'));
        const privateCars = parseFloat(d3.select('#privateCarsSlider').property('value'));
        const total = walking + publicTransport + privateCars;
        
        // The slider that triggered the event keeps its value
        // The other two sliders adjust proportionally to fill the remaining percentage
        const adjustedPublicTransport = 100 * publicTransport / total;
        const adjustedPrivateCars = 100 * privateCars / total;
        const adjustedWalking = 100 * walking / total;
    
        // Update the actual sliders' positions
        d3.select('#walkingSlider').property('value', adjustedWalking);
        d3.select('#publicTransportSlider').property('value', adjustedPublicTransport);
        d3.select('#privateCarsSlider').property('value', adjustedPrivateCars);
    
        const data = {
            walking: adjustedWalking,
            publicTransport: adjustedPublicTransport,
            privateCars: adjustedPrivateCars
        };
    
        const pointPosition = calculatePointPosition(data);
        userPoint
            .attr('cx', pointPosition.x)
            .attr('cy', pointPosition.y);
    
        // Update slider values displayed to the user
        d3.select('#walkingValue').text(adjustedWalking.toFixed(0));
        d3.select('#publicTransportValue').text(adjustedPublicTransport.toFixed(0));
        d3.select('#privateCarsValue').text(adjustedPrivateCars.toFixed(0));
    }

    // Initialize sliders with the event listener
    d3.selectAll('.slider').on('input', updatePosition);

    // Initial update for the position
    updatePosition();

</script>
</body>
</html>

       
